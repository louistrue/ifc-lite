# Documentation Update Plan

Comprehensive plan to bring ALL documentation in sync with the current state of the ifc-lite codebase (v1.6.1).

## Audit Summary

The codebase has **18 npm packages**, **3 Rust crates**, **3 apps** (viewer, server, desktop), and significant recent features (BCF, IDS, 2D drawings, multi-model federation, property mutations) that are partially or completely undocumented. The docs reference "12 packages" in several places when there are actually 18.

---

## Phase 1: README.md (Root)

The README is the first thing users and contributors see. It must be accurate.

### 1.1 Update Packages Table

**Problem:** The Packages table lists only 11 npm packages. Missing 7:

| Missing Package | What It Does |
|-----------------|--------------|
| `@ifc-lite/bcf` | BIM Collaboration Format (viewpoints, topics, comments) |
| `@ifc-lite/ids` | IDS (Information Delivery Specification) validation |
| `@ifc-lite/mutations` | Property editing with bidirectional change tracking |
| `@ifc-lite/drawing-2d` | 2D architectural drawings (sections, floor plans, elevations) |
| `@ifc-lite/codegen` | Code generation from IFC EXPRESS schemas |
| `@ifc-lite/server-bin` | Pre-built server binary distribution |
| `@ifc-lite/ifcx` | IFC5 (IFCX) parser (listed in features but not in packages table) |

**Action:** Add all missing packages to the table with accurate status and doc links.

### 1.2 Update Project Structure Tree

**Problem:** The `Project Structure` section lists only 10 packages in the tree. Missing:
- `ifcx/`, `bcf/`, `ids/`, `mutations/`, `drawing-2d/`, `server-bin/`, `create-ifc-lite/`

**Action:** Update the tree to include all 18 packages with accurate one-line descriptions.

### 1.3 Update Features Table

**Problem:** Features table doesn't mention:
- Multi-model federation (loading multiple IFC files with unified selection/visibility)
- BCF collaboration support
- IDS validation
- 2D drawing generation
- Property editing/mutations

**Action:** Add rows for new features. Keep table concise.

### 1.4 Update Architecture Mermaid Diagram

**Problem:** The flow diagram shows a simple linear pipeline. It doesn't reflect:
- Multi-model federation (idOffset, FederationRegistry)
- BCF/IDS as side inputs
- 2D drawing output path
- Mutation feedback loop

**Action:** Extend the diagram or add a second diagram showing the full feature set.

### 1.5 Verify All Code Examples

**Problem:** Code examples in Basic Usage may not match current API signatures.

**Action:** Cross-reference every code snippet against actual source. Ensure imports, method names, and types are correct.

---

## Phase 2: docs/index.md (Documentation Portal)

### 2.1 Fix Package Count

**Problem:** Says "Complete API documentation for all 12 TypeScript packages." Should say 18.

**Action:** Update to "18 TypeScript packages".

### 2.2 Update Packages List

**Problem:** Bottom packages list is incomplete:
```
TypeScript: @ifc-lite/parser, geometry, renderer, server-client, cache, query, export
```

Missing: `data`, `spatial`, `ifcx`, `bcf`, `ids`, `mutations`, `drawing-2d`, `codegen`, `server-bin`, `wasm`, `create-ifc-lite`

**Action:** List all packages or group by category (core, features, tools).

### 2.3 Add Cards for New Features

**Action:** Add navigation cards for:
- BCF Collaboration
- IDS Validation
- 2D Drawings
- Multi-Model Federation
- Property Editing

---

## Phase 3: Changeset & Release Documentation

### 3.1 RELEASE.md - Minor Updates

**Status:** Already in good shape. Minor updates needed:

- Update "fixed" mode explanation to reflect all 18 packages bumping together
- Add note about `@ifc-lite/desktop` versioning separately (currently at 1.1.7 vs 1.6.1)
- Mention the cross-platform server binary build step in the release workflow
- Add link to the actual GitHub Actions workflow file

### 3.2 .changeset/config.json - No Changes Needed

Current config is correct. Fixed mode for `@ifc-lite/*`, GitHub changelog, public access.

### 3.3 CHANGELOG Files - Automated, No Manual Work

The 19 CHANGELOG files are auto-generated by Changesets. No manual updates needed.

---

## Phase 4: New Guide Pages (docs/guide/)

These features exist in code but have NO documentation pages.

### 4.1 Create `docs/guide/federation.md` - Multi-Model Federation

**Content:**
- What federation is and why it matters
- Loading multiple models (`useIfc` hook patterns)
- Global vs local IDs (`expressId + model.idOffset`)
- FederationRegistry and ID range management
- Unified selection and visibility across models
- `resolveGlobalIdFromModels()` usage
- EntityRef pattern (`{ modelId, expressId }`)
- Performance considerations with multiple models

**Source code to reference:**
- `apps/viewer/src/store/slices/modelSlice.ts`
- `apps/viewer/src/hooks/useIfc.ts`
- `apps/viewer/src/utils/federationRegistry.ts`

### 4.2 Create `docs/guide/bcf.md` - BIM Collaboration Format

**Content:**
- What BCF is (ISO 16739 companion standard)
- Loading BCF files (`.bcf`, `.bcfzip`)
- Topics, viewpoints, comments
- Creating and managing viewpoints
- Camera state serialization
- Component visibility/selection in viewpoints
- Export/save BCF files

**Source code to reference:**
- `packages/bcf/`
- `apps/viewer/src/store/slices/bcfSlice.ts`
- `apps/viewer/src/components/viewer/BCFPanel.tsx`

### 4.3 Create `docs/guide/ids.md` - IDS Validation

**Content:**
- What IDS is (buildingSMART Information Delivery Specification)
- Loading IDS rule files
- Validation results (pass/fail per entity)
- Facet types and constraint types
- Filtering entities by validation status
- IDS panel usage in the viewer

**Source code to reference:**
- `packages/ids/`
- `apps/viewer/src/store/slices/idsSlice.ts`
- `apps/viewer/src/components/viewer/IDSPanel.tsx`

### 4.4 Create `docs/guide/drawing-2d.md` - 2D Drawings

**Content:**
- What 2D drawing generation does
- Section cuts and floor plans
- SVG output with annotations
- Drawing sheets and title blocks
- Display options and styling
- Elevation views

**Source code to reference:**
- `packages/drawing-2d/`
- `apps/viewer/src/store/slices/drawing2DSlice.ts`
- `apps/viewer/src/store/slices/sheetSlice.ts`
- `apps/viewer/src/components/viewer/Section2DPanel.tsx`

### 4.5 Create `docs/guide/mutations.md` - Property Editing

**Content:**
- Editing IFC properties in-place
- Bidirectional change tracking
- Bulk property editing
- Mutation history and undo
- Export of modified IFC files

**Source code to reference:**
- `packages/mutations/`
- `apps/viewer/src/store/slices/mutationSlice.ts`
- `apps/viewer/src/components/viewer/PropertyEditor.tsx`

### 4.6 Create `docs/guide/desktop.md` - Desktop App Guide

**Problem:** Desktop app section exists in README but has no dedicated guide page.

**Content:**
- Why desktop (multi-threading, no WASM limits, filesystem access)
- Installation and prerequisites (Rust toolchain, Tauri v2)
- Development workflow
- Native commands (parse_ifc_buffer, get_geometry, etc.)
- Building for Windows/macOS/Linux
- Binary caching system
- Differences from web version

**Source code to reference:**
- `apps/desktop/`
- `apps/desktop/src-tauri/src/commands/`

---

## Phase 5: Update Existing Guide Pages

### 5.1 `docs/guide/quickstart.md`

- Add quick start paths for BCF, IDS, 2D drawings
- Mention multi-model loading
- Verify all code examples against current API

### 5.2 `docs/guide/parsing.md`

- Verify IFC5 parsing examples match current `@ifc-lite/ifcx` API
- Add note about auto-format detection
- Mention `parseAuto` if it exists

### 5.3 `docs/guide/rendering.md`

- Add section plane documentation (sectionSlice)
- Add measurement tool documentation (measurementSlice)
- Mention WebGPU feature detection

### 5.4 `docs/guide/querying.md`

- Verify query API against current `@ifc-lite/query` package
- Add examples for multi-model queries

### 5.5 `docs/guide/exporting.md`

- Verify export formats (GLB, Parquet, Arrow, IFC)
- Add IFC export (recently added feature)
- Add GLB import (recently added feature)

### 5.6 `docs/guide/server.md`

- Note that client-side WASM is now the default (recent change)
- Server requires explicit opt-in
- Verify endpoint documentation against actual server routes

---

## Phase 6: Architecture Documentation Updates

### 6.1 `docs/architecture/overview.md`

- Add multi-model federation to the architecture diagrams
- Add BCF/IDS as feature layers
- Mention 2D drawing pipeline
- Update package count references

### 6.2 `docs/architecture/data-flow.md`

- Add federation data flow (idOffset, global ID resolution)
- Add mutation data flow (edit -> track -> export)

### 6.3 `docs/architecture/rendering-pipeline.md`

- Add section plane rendering
- Add measurement overlay rendering
- Add 2D drawing generation pipeline

### 6.4 New: `docs/architecture/federation.md`

- Detailed architecture of multi-model federation
- ID range management
- FederationRegistry internals
- Memory and performance implications

---

## Phase 7: API Reference Updates

### 7.1 `docs/api/typescript.md`

**Problem:** Likely missing API docs for newer packages.

**Action:** Add API reference sections for:
- `@ifc-lite/bcf` - BCF reader/writer classes
- `@ifc-lite/ids` - IDS validator interfaces
- `@ifc-lite/mutations` - Mutation tracker API
- `@ifc-lite/drawing-2d` - 2D generation API
- `@ifc-lite/codegen` - Code generator API
- `@ifc-lite/server-bin` - Server binary configuration

Verify all existing package API docs match current exports.

### 7.2 `docs/api/rust.md`

- Verify crate API docs match current Rust code
- Add any new public API surfaces

### 7.3 `docs/api/wasm.md`

- Verify WASM binding docs match current exports

---

## Phase 8: mkdocs.yml Navigation Update

### 8.1 Add New Guide Pages to Nav

```yaml
nav:
  - Home: index.md
  - Getting Started:
    - Installation: guide/installation.md
    - Quick Start: guide/quickstart.md
    - Server Guide: guide/server.md
    - Desktop App: guide/desktop.md          # NEW
    - Browser Requirements: guide/browser-requirements.md
  - User Guide:
    - Parsing IFC Files: guide/parsing.md
    - Geometry Processing: guide/geometry.md
    - Rendering: guide/rendering.md
    - Querying Data: guide/querying.md
    - Exporting Data: guide/exporting.md
    - Multi-Model Federation: guide/federation.md  # NEW
    - BCF Collaboration: guide/bcf.md              # NEW
    - IDS Validation: guide/ids.md                 # NEW
    - 2D Drawings: guide/drawing-2d.md             # NEW
    - Property Editing: guide/mutations.md         # NEW
  - Architecture:
    - Overview: architecture/overview.md
    - Data Flow: architecture/data-flow.md
    - Parsing Pipeline: architecture/parsing-pipeline.md
    - Geometry Pipeline: architecture/geometry-pipeline.md
    - Rendering Pipeline: architecture/rendering-pipeline.md
    - Coordinate Handling: architecture/coordinate-handling.md
    - Federation: architecture/federation.md       # NEW
  - API Reference:
    - TypeScript API: api/typescript.md
    - Rust API: api/rust.md
    - WASM Bindings: api/wasm.md
  - Tutorials:
    - Building a Viewer: tutorials/building-viewer.md
    - Custom Queries: tutorials/custom-queries.md
    - Extending the Parser: tutorials/extending-parser.md
  - Contributing:
    - Development Setup: contributing/setup.md
    - Testing: contributing/testing.md
    - Release Process: contributing/release.md     # NEW (link to RELEASE.md content)
```

---

## Phase 9: Package-Level READMEs

### 9.1 Packages Missing README

Check and create READMEs for packages that lack them:
- `@ifc-lite/bcf`
- `@ifc-lite/ids` (has one)
- `@ifc-lite/mutations`
- `@ifc-lite/drawing-2d`
- `@ifc-lite/renderer`
- `@ifc-lite/geometry`
- `@ifc-lite/data`
- `@ifc-lite/spatial`
- `@ifc-lite/query`
- `@ifc-lite/export`
- `@ifc-lite/cache`
- `@ifc-lite/server-client`
- `@ifc-lite/ifcx`

Each package README should follow a consistent template:
```
# @ifc-lite/{name}
One-line description.

## Installation
## Quick Start
## API
## License
```

### 9.2 Update Existing Package READMEs

- `@ifc-lite/parser` README - verify API examples match current code
- `@ifc-lite/wasm` README - verify build instructions
- `@ifc-lite/codegen` README - verify EXPRESS schema instructions

---

## Phase 10: Miscellaneous

### 10.1 `CLAUDE.md` - Minor Updates

- Update package count (says "packages/" without count)
- Add federation patterns for BCF, IDS, 2D
- Add new store slices to "Key Patterns"

### 10.2 `.cursorrules` - Verify Accuracy

- Ensure changeset workflow instructions match current RELEASE.md
- Verify license header requirements

### 10.3 `CONTRIBUTORS.md` - No Urgent Changes

- Structure is fine, will grow organically

### 10.4 `IFC5-FEDERATED-LOADING-PLAN.md`

- Review whether this plan has been implemented
- If implemented, move to docs/architecture/ as reference
- If partially done, update status markers

---

## Execution Order (Recommended)

The phases above are ordered by impact. Recommended execution:

| Priority | Phase | Effort | Impact |
|----------|-------|--------|--------|
| 1 | Phase 1: README.md | Medium | Highest - first thing users see |
| 2 | Phase 2: docs/index.md | Low | High - documentation entry point |
| 3 | Phase 7: API Reference | High | High - developers need accurate API docs |
| 4 | Phase 4: New Guides | High | High - undocumented features |
| 5 | Phase 8: mkdocs.yml | Low | Medium - navigation for new pages |
| 6 | Phase 5: Update Existing Guides | Medium | Medium - accuracy |
| 7 | Phase 3: Changeset/Release | Low | Medium - contributor workflow |
| 8 | Phase 6: Architecture Docs | Medium | Medium - design understanding |
| 9 | Phase 9: Package READMEs | Medium | Lower - per-package users |
| 10 | Phase 10: Miscellaneous | Low | Lower - AI/editor config |

---

## Verification Checklist

After all updates, verify:

- [ ] All 18 npm packages mentioned in README packages table
- [ ] All 3 Rust crates mentioned in README crates table
- [ ] All 3 apps (viewer, server, desktop) documented
- [ ] Package count is "18" everywhere (not "12")
- [ ] Every code example compiles/runs against current API
- [ ] mkdocs.yml nav includes all guide pages
- [ ] Every docs/ markdown file is reachable from navigation
- [ ] No broken internal links between docs
- [ ] Changeset workflow accurately described
- [ ] Feature list matches actual implemented features
- [ ] Performance numbers match latest benchmarks
- [ ] Browser support table is current
- [ ] IFC5-FEDERATED-LOADING-PLAN.md status is accurate
- [ ] All new guide pages have consistent structure
- [ ] Package READMEs follow consistent template
