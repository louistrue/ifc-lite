# IFC-Lite Project Rules

## License Headers

All new source files MUST include the Mozilla Public License 2.0 header at the top.

### TypeScript/JavaScript/CSS files (.ts, .tsx, .js, .css):
```
/* This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/. */
```

### Rust files (.rs):
```
// This Source Code Form is subject to the terms of the Mozilla Public
// License, v. 2.0. If a copy of the MPL was not distributed with this
// file, You can obtain one at https://mozilla.org/MPL/2.0/.
```

## Code Style

- Use TypeScript for all frontend/Node.js code
- Use Rust for performance-critical WASM modules
- Follow existing patterns in the codebase
- Keep functions small and focused
- Prefer explicit types over inference for public APIs

## Project Structure

- `rust/` - Rust/WASM core (parsing, geometry)
- `packages/` - TypeScript packages
- `apps/viewer/` - React viewer application
- `docs/` - MkDocs documentation

## Generated Files (Do Not Edit)

- `packages/codegen/generated/`
- `packages/parser/src/generated/`
- `packages/wasm/ifc_lite_wasm.js`
- `packages/wasm/ifc_lite_wasm.d.ts`
- Any `dist/` folders
- `CHANGELOG.md` files (generated by Changesets)

## Changesets Workflow (REQUIRED for releases)

This project uses [Changesets](https://github.com/changesets/changesets) for versioning and releases.

### When to Add a Changeset

**ALWAYS** add a changeset when making changes that affect published packages:
- Bug fixes → `patch`
- New features (backwards-compatible) → `minor`
- Breaking changes → `major`

**Skip changesets** for:
- CI/GitHub Actions changes only
- Documentation-only changes (unless notable)
- Test-only changes
- Dev dependency updates

### How to Add a Changeset

```bash
pnpm changeset
```

Or create a file manually in `.changeset/` with format:
```markdown
---
"@ifc-lite/parser": minor
"@ifc-lite/geometry": minor
---

Description of changes (this goes in CHANGELOG)
```

### Changeset Rules

1. **Include the changeset file in your PR** - commit `.changeset/*.md` files
2. **Write user-facing descriptions** - these appear in CHANGELOG.md
3. **Choose appropriate bump types** based on semver
4. **All @ifc-lite/* packages are linked** - they bump together to the same version

### DO NOT

- ❌ Manually edit version numbers in `package.json` or `Cargo.toml`
- ❌ Create git tags manually
- ❌ Edit `CHANGELOG.md` directly
- ❌ Run `pnpm publish` manually (CI handles it)

### Release Process

1. PR with changeset merges to `main`
2. Changesets bot creates "Version Packages" PR
3. Maintainer merges "Version Packages" PR
4. CI automatically publishes to npm and crates.io

### Quick Reference

```bash
pnpm changeset          # Add a changeset (interactive)
npx changeset status    # See pending changesets
pnpm version            # Preview version bumps (maintainers)
ls .changeset/*.md      # List changeset files
```
